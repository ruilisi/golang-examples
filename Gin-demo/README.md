# Gim-demo
## 项目构成
该项目由main.go, /sql sql.go ,  /scripts initdb.sh, 相关的HTML文件和相应的依赖生成文件 go.mod等构成
其中 main.go 控制项目启动，浏览器页面渲染，数据交互等功能
sql.go 对相应的数据库操作进行支持
initdb.sh 作为生成数据库脚本
signin.html 作为登录界面
signup.html 作为注册界面
profile.html 作为登陆成功进入界面
## 项目运行
确保各项依赖安装完毕，数据库已经创建的情况下，通过
`go run main.go`
启动gin项目，通过localhost://3000/sigin访问页面

## main.go
### User struct
作为数据模型，对用户输入数据进行关系映射
### `PhoneCheckRule()`
判断接收字符是否为中国大陆手机号码，通过正则表达式进行匹配，返回布尔值
### `EmailCheckRule()`
判断接收字符是否为电子邮箱，通过正则表达式进行匹配，返回布尔值
### `PasswordCheck()`
判断接收字符是否包含大小写英文以及数字且长度大于8位，通过多段查询匹配的方式进行匹配，返回布尔值
### `signupInit()`
通过HTML方法对页面进行初始化的渲染
### `signinInit()`
通过HTML方法对页面进行初始化渲染
### `profileInit()`
通过cookie获取用户登录名称，若处于未登录状态，则将页面永久重定向到signin页面，
若获取到用户名，则通过`gin.H{}`方法向前端{{ }}标签内传值
### `signupHandler()`
通过`PostForm()`方法获取前端表单内的相应name属性值的数据,获取用户输入的用户名和密码
对用户输入进行数据校验，若不符合规范，则通过`HTML()`方法对前端页面进行重新渲染，附加上错误信息
符合规范，则将用户数据导入到数据库内，然后将页面重定向到signin登录界面
注意conn的连接和关闭
### `signinHandler()`
通过`PostForm()`方法获取用户输入用户名和密码，通过原生js在hidden文本框内生成的值判断submit类型，
如果点击注册按钮，则将页面重定向到注册界面，如果是登录按钮，则进行后续校验
通过sql语句将用户信息获取，取出数据库中相应数据并将两者密码进行校验(数据库由于字段定义的问题，需要注意可能出现的空格填充，如"a   "和"a")
若登录失败，则页面通过`HTML()`方法进行重新渲染，通过`gin.H{}`向前端传递显示登录失败信息
若登录成功,通过cookie方式将用户登录信息进行保存，以供后续校验，此处cookie的声明周期为5min
将页面重定向的profile页面
### `main()`
与数据库建立连接并等待关闭
设定路由，通过`LoadHTMLGlob(*.html)`方法获取项目下所有html文档路径
将路由请求和方法进行绑定
通过`Run()`运行程序，默认端口为8080，指定为3000

## sql.go
### `db`
全局sql.DB类型指针
### `SqlOpen()`
与指定数据库建立连接，包含数据库，端口号，用户名，登录密码，数据库名称以及安全验证模式
### `SqlInsert()`
通过$操作符为sql语句中的变量传入值
通过`Prepare()`和`Exec()`方法执行含有参数的sql语句
### `SqlSelect()`
通过`QueryROw()`方法查询数据库中的一段数据， 并通过`Scan()`方法去获取可能出现的错误
